---
- hosts: centos
  become: true
  tasks:
    - name: get cpu usage
      shell: "top -b -n 1"
      register: top

    - name: set cpu usage facts
      set_fact:
        user_cpu: "{{top.stdout_lines[2].split()[1]}}"
        system_cpu: "{{top.stdout_lines[2].split()[3]}}"
    - name: output cpu usage facts
      debug:
        msg:
         - "user cpu usage: {{user_cpu}}"
         - "system cpu usage: {{system_cpu}}"

